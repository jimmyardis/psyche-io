<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Unified Cosmic Psyche v6: 3D Camera Controls</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { margin: 0; background-color: #020617; color: white; overflow: hidden; font-family: ui-sans-serif, system-ui, sans-serif; }
        .tab-btn { padding: 0.5rem 1rem; border-bottom: 2px solid transparent; transition: all 0.2s; cursor: pointer; color: #94a3b8; }
        .tab-btn.active { border-bottom-color: #6366f1; color: white; }
        
        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .accretion-disk { animation: spin-slow 4s linear infinite; }
        
        /* 3D Quantum Micro Orbits */
        @keyframes orbit-path {
            from { transform: rotateZ(0deg); }
            to { transform: rotateZ(360deg); }
        }
        
        @keyframes counter-rotate {
            from { transform: rotateZ(360deg) rotateX(-90deg); }
            to { transform: rotateZ(0deg) rotateX(-90deg); }
        }

        .orbit-ring {
            position: absolute;
            top: 50%; left: 50%;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transform-style: preserve-3d;
        }

        .satellite-carrier {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            transform-style: preserve-3d;
        }

        /* 3D Sphere styling for the core nodes */
        .sphere-node {
            box-shadow: inset -10px -10px 20px rgba(0,0,0,0.5), 0 0 20px rgba(255,255,255,0.2);
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const systemData = {
            blackHoles: [{ id: 'bh1', name: 'The Void (Addiction)', x: window.innerWidth/2 + 300, y: window.innerHeight/2 + 250, radius: 60, color: '#1e1b4b', eventHorizon: 100 }],
            memeplexes: [{ id: 'm1', name: 'Spiritual/Meaning Framework', x: window.innerWidth/2 - 300, y: window.innerHeight/2 - 200, color: '#fcd34d', radius: 180 }],
            
            parts: [
                { id: 'p0', name: 'THE SELF', x: window.innerWidth/2, y: window.innerHeight/2, vx: 0, vy: 0, color: '#ffffff', isSelf: true, satellites: [] },
                { id: 'p1', name: 'The Manager', x: window.innerWidth/2, y: window.innerHeight/2 - 150, vx: 0, vy: 0, color: '#60a5fa', satellites: ['Scheduling', 'Control', 'Future-Casting', 'Anxiety', 'To-Do Lists', 'Fixing'] },
                { id: 'p2', name: 'The Critic', x: window.innerWidth/2 + 130, y: window.innerHeight/2 - 75, vx: 0, vy: 0, color: '#f472b6', satellites: ['Self-Doubt', 'Comparison', 'Shaming', 'Perfectionism', 'Guilt Trip', 'Evaluation'] },
                { id: 'p3', name: 'The Seeker', x: window.innerWidth/2 + 130, y: window.innerHeight/2 + 75, vx: 0, vy: 0, color: '#4ade80', satellites: ['Craving', 'Impulse Buying', 'Dopamine', 'Restlessness', 'Bargaining', 'Tunnel Vision'] },
                { id: 'p4', name: 'The Firefighter', x: window.innerWidth/2, y: window.innerHeight/2 + 150, vx: 0, vy: 0, color: '#f87171', satellites: ['Numbing', 'Dissociation', 'Bingeing', 'Distraction', 'Escapism', 'Urgency'] },
                { id: 'p5', name: 'The Exile', x: window.innerWidth/2 - 130, y: window.innerHeight/2 + 75, vx: 0, vy: 0, color: '#a78bfa', satellites: ['Fear', 'Worthlessness', 'Tears', 'Isolation', 'Flashbacks', 'Despair'] },
                { id: 'p6', name: 'The Mystic', x: window.innerWidth/2 - 130, y: window.innerHeight/2 - 75, vx: 0, vy: 0, color: '#fb923c', satellites: ['Awe', 'Connection', 'Artistic', 'Meaning', 'Flow State', 'Intuition'] }
            ],
            
            spokeDist: 180,
            rimDist: 180,
            orbitRadius: 100, 
            springLinks: [
                { source: 'p0', target: 'p1', type: 'spoke' }, { source: 'p0', target: 'p2', type: 'spoke' },
                { source: 'p0', target: 'p3', type: 'spoke' }, { source: 'p0', target: 'p4', type: 'spoke' },
                { source: 'p0', target: 'p5', type: 'spoke' }, { source: 'p0', target: 'p6', type: 'spoke' },
                { source: 'p1', target: 'p2', type: 'rim' }, { source: 'p2', target: 'p3', type: 'rim' },
                { source: 'p3', target: 'p4', type: 'rim' }, { source: 'p4', target: 'p5', type: 'rim' },
                { source: 'p5', target: 'p6', type: 'rim' }, { source: 'p6', target: 'p1', type: 'rim' }
            ]
        };

        const CosmicCanvas = () => {
            const [parts, setParts] = useState(systemData.parts);
            
            // --- 3D CAMERA STATE ---
            // Start tilted so the 3D effect is immediately obvious
            const [camera, setCamera] = useState({ rotX: 60, rotY: -20, zoom: 0.8 });
            const [isPanning, setIsPanning] = useState(false);
            const cameraRef = useRef(camera);
            
            useEffect(() => { cameraRef.current = camera; }, [camera]);

            const requestRef = useRef();

            // PHYSICS ENGINE
            const updatePhysics = () => {
                setParts(currentParts => {
                    return currentParts.map(part => {
                        if (part.isDragging) return part;
                        let { x, y, vx, vy } = part;

                        // Springs
                        systemData.springLinks.forEach(link => {
                            let other = null;
                            if (link.source === part.id) other = currentParts.find(p => p.id === link.target);
                            if (link.target === part.id) other = currentParts.find(p => p.id === link.source);
                            
                            if (other) {
                                const dx = other.x - x; 
                                const dy = other.y - y;
                                const dist = Math.sqrt(dx*dx + dy*dy);
                                const targetDist = link.type === 'spoke' ? systemData.spokeDist : systemData.rimDist;
                                if (dist > 0) {
                                    const force = (dist - targetDist) * 0.003;
                                    vx += (dx / dist) * force;
                                    vy += (dy / dist) * force;
                                }
                            }
                        });

                        // Black Holes
                        systemData.blackHoles.forEach(bh => {
                            const dx = bh.x - x; const dy = bh.y - y;
                            const dist = Math.sqrt(dx*dx + dy*dy);
                            if (dist < bh.eventHorizon) {
                                vx += dx * 0.08; vy += dy * 0.08; 
                            } else if (dist < 400 && !part.isSelf) {
                                vx += (dx * 0.8) / (dist * 0.05) * 0.0015;
                                vy += (dy * 0.8) / (dist * 0.05) * 0.0015;
                            }
                        });

                        // Center anchor
                        if (part.isSelf) {
                            vx += (window.innerWidth / 2 - x) * 0.05;
                            vy += (window.innerHeight / 2 - y) * 0.05;
                        }

                        vx *= 0.92; vy *= 0.92; // Friction
                        return { ...part, x: x + vx, y: y + vy, vx, vy };
                    });
                });
                requestRef.current = requestAnimationFrame(updatePhysics);
            };

            useEffect(() => {
                requestRef.current = requestAnimationFrame(updatePhysics);
                return () => cancelAnimationFrame(requestRef.current);
            }, []);

            // --- CAMERA CONTROLS ---
            const handleBackgroundDown = (e) => { setIsPanning(true); };
            const handleGlobalUp = () => { setIsPanning(false); };
            
            const handleGlobalMove = (e) => {
                if (isPanning) {
                    setCamera(prev => ({
                        ...prev,
                        rotX: Math.max(-85, Math.min(85, prev.rotX - e.movementY * 0.5)),
                        rotY: prev.rotY + e.movementX * 0.5
                    }));
                }
            };

            const handleWheel = (e) => {
                setCamera(prev => ({
                    ...prev,
                    zoom: Math.max(0.3, Math.min(2.5, prev.zoom - e.deltaY * 0.002))
                }));
            };

            // --- NODE DRAGGING (Adjusted for camera zoom) ---
            const handleDragStart = (id, e) => {
                e.stopPropagation(); // Stop background from panning when dragging a node
                setParts(prev => prev.map(p => p.id === id ? { ...p, isDragging: true } : p));
                
                const handleMouseMove = (ev) => {
                    setParts(prev => prev.map(p => {
                        if (p.id === id) {
                            // Divide by zoom so mouse movements feel 1-to-1 even when zoomed out
                            const moveX = ev.movementX / cameraRef.current.zoom;
                            const moveY = ev.movementY / cameraRef.current.zoom;
                            return { ...p, x: p.x + moveX, y: p.y + moveY, vx: 0, vy: 0 };
                        }
                        return p;
                    }));
                };
                const handleMouseUp = () => {
                    setParts(prev => prev.map(p => p.id === id ? { ...p, isDragging: false } : p));
                    window.removeEventListener('mousemove', handleMouseMove);
                    window.removeEventListener('mouseup', handleMouseUp);
                };
                window.addEventListener('mousemove', handleMouseMove);
                window.addEventListener('mouseup', handleMouseUp);
            };

            return (
                <div className="relative w-full h-full overflow-hidden select-none bg-slate-950"
                     onMouseDown={handleBackgroundDown}
                     onMouseMove={handleGlobalMove}
                     onMouseUp={handleGlobalUp}
                     onMouseLeave={handleGlobalUp}
                     onWheel={handleWheel}
                     style={{ perspective: '2000px', cursor: isPanning ? 'grabbing' : 'grab' }}
                >
                    {/* UI Overlay */}
                    <div className="absolute top-4 left-4 z-50 bg-black/50 p-4 rounded-xl border border-slate-800 backdrop-blur pointer-events-none">
                        <p className="text-slate-300 text-sm mb-2">üì∏ <strong>Camera Controls</strong></p>
                        <ul className="text-xs text-slate-500 space-y-1">
                            <li>‚Ä¢ Click & Drag background to Rotate</li>
                            <li>‚Ä¢ Scroll wheel to Zoom</li>
                            <li>‚Ä¢ Click & Drag nodes to move Parts</li>
                        </ul>
                    </div>

                    {/* THE 3D SCENE CONTAINER */}
                    <div className="w-full h-full absolute inset-0"
                         style={{
                             transform: `scale(${camera.zoom}) rotateX(${camera.rotX}deg) rotateY(${camera.rotY}deg)`,
                             transformStyle: 'preserve-3d',
                             transition: isPanning ? 'none' : 'transform 0.1s ease-out'
                         }}
                    >
                        {/* The 2D Flat Plane (Springs, Black Holes) */}
                        <svg className="absolute inset-0 w-full h-full overflow-visible" style={{ transformStyle: 'preserve-3d' }}>
                            {systemData.blackHoles.map(bh => (
                                <g key={bh.id}>
                                    <circle cx={bh.x} cy={bh.y} r={bh.radius * 2} fill={`url(#grad-${bh.id})`} opacity="0.6" className="accretion-disk"/>
                                    <circle cx={bh.x} cy={bh.y} r={bh.radius} fill="black" stroke={bh.color} strokeWidth="2" />
                                    <defs><radialGradient id={`grad-${bh.id}`}><stop offset="30%" stopColor="black" /><stop offset="70%" stopColor={bh.color} /><stop offset="100%" stopColor="transparent" /></radialGradient></defs>
                                </g>
                            ))}
                            {systemData.springLinks.map((link, i) => {
                                const s = parts.find(p => p.id === link.source);
                                const t = parts.find(p => p.id === link.target);
                                if (!s || !t) return null;
                                const isSpoke = link.type === 'spoke';
                                return <line key={i} x1={s.x} y1={s.y} x2={t.x} y2={t.y} 
                                    stroke={isSpoke ? "rgba(255,255,255,0.4)" : "rgba(255,255,255,0.15)"} 
                                    strokeWidth={isSpoke ? "3" : "1"} 
                                    strokeDasharray={isSpoke ? "none" : "5,5"} 
                                />;
                            })}
                        </svg>

                        {/* The 3D Nodes */}
                        {parts.map(part => {
                            return (
                                <div key={part.id} 
                                    onMouseDown={(e) => handleDragStart(part.id, e)}
                                    className="absolute"
                                    style={{ 
                                        left: part.x, top: part.y,
                                        transformStyle: 'preserve-3d',
                                        cursor: 'pointer'
                                    }}
                                >
                                    {/* 3D Sphere Core */}
                                    <div className={`absolute transform -translate-x-1/2 -translate-y-1/2 rounded-full sphere-node z-20
                                         ${part.isSelf ? 'w-20 h-20 bg-white' : 'w-12 h-12'}`}
                                         style={{ 
                                             backgroundColor: part.color,
                                             // Billboarding the core slightly so shadows look consistent
                                             transform: `translate(-50%, -50%) rotateX(${-camera.rotX}deg) rotateY(${-camera.rotY}deg)`
                                         }}>
                                    </div>
                                    
                                    {/* Orbiting Quantum Rings */}
                                    {!part.isSelf && part.satellites.map((meme, index) => {
                                        const tiltY = index * (180 / part.satellites.length); 
                                        const orbitDuration = 8 + (index % 3); 
                                        
                                        return (
                                            <div key={index} className="orbit-ring" 
                                                style={{ 
                                                    width: `${systemData.orbitRadius * 2}px`, 
                                                    height: `${systemData.orbitRadius * 2}px`,
                                                    marginTop: `-${systemData.orbitRadius}px`, 
                                                    marginLeft: `-${systemData.orbitRadius}px`,
                                                    // This creates the spherical atom look
                                                    transform: `rotateX(70deg) rotateY(${tiltY}deg)` 
                                                }}
                                            >
                                                <div className="satellite-carrier" style={{ animation: `orbit-path ${orbitDuration}s linear infinite` }}>
                                                    {/* The Satellite Node */}
                                                    <div className="absolute top-0 left-1/2 w-4 h-4 -ml-2 -mt-2 rounded-full shadow-lg"
                                                         style={{ backgroundColor: part.color, boxShadow: `0 0 10px ${part.color}` }}>
                                                        
                                                        {/* Satellite Label (Counter-rotates to stay upright) */}
                                                        <div className="hidden hover:block absolute -top-6 text-[10px] bg-black/90 text-white px-2 py-0.5 rounded whitespace-nowrap"
                                                             style={{ animation: `counter-rotate ${orbitDuration}s linear infinite` }}>
                                                            {meme}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        )
                                    })}

                                    {/* Main Part Label (BILLBOARDING - Always faces the camera!) */}
                                    <div className="absolute font-bold text-slate-200 whitespace-nowrap bg-slate-900/90 px-3 py-1 rounded-full border border-slate-700 z-30"
                                         style={{
                                             // Position it below the node
                                             marginTop: part.isSelf ? '40px' : '60px',
                                             marginLeft: '-50%',
                                             // Reverse the global camera rotation so text stays perfectly readable
                                             transform: `rotateX(${-camera.rotX}deg) rotateY(${-camera.rotY}deg)`
                                         }}>
                                        {part.name}
                                    </div>
                                </div>
                            )
                        })}
                    </div>
                </div>
            );
        };

        const SchemaView = () => (
            <div className="p-8 h-full bg-slate-900">
                <h2 className="text-xl font-bold mb-6 text-indigo-400">Data Schema</h2>
                <p className="text-slate-400">View source to see the data relationships.</p>
            </div>
        );

        const MindMapView = () => (
            <div className="p-8 h-full bg-slate-900">
                <h2 className="text-xl font-bold mb-6 text-indigo-400">Mind Map</h2>
                <p className="text-slate-400">View source for hierarchy.</p>
            </div>
        );

        const App = () => {
            const [activeTab, setActiveTab] = useState('canvas');
            return (
                <div className="flex flex-col h-screen">
                    <div className="bg-slate-950 border-b border-slate-800 p-4 flex justify-between items-center z-50">
                        <div className="flex items-center gap-3">
                            <span className="text-2xl">üî≠</span>
                            <h1 className="text-xl font-bold tracking-tight">Psyche-OS <span className="text-slate-500 text-sm font-normal">v6.0 3D Camera</span></h1>
                        </div>
                        <div className="flex gap-2">
                            <button className={`flex items-center gap-2 tab-btn ${activeTab === 'canvas' ? 'active' : ''}`} onClick={() => setActiveTab('canvas')}>‚öõÔ∏è Canvas</button>
                            <button className={`flex items-center gap-2 tab-btn ${activeTab === 'schema' ? 'active' : ''}`} onClick={() => setActiveTab('schema')}>üóÑÔ∏è Schema</button>
                        </div>
                    </div>
                    <div className="flex-1 relative">
                        {activeTab === 'canvas' && <CosmicCanvas />}
                        {activeTab === 'schema' && <SchemaView />}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
